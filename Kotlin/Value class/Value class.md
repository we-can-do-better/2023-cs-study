# Value Class

## ğŸ¦®Â  ê°œìš”

---

### ë§Œë“¤ì–´ì§„ ê³„ê¸°

```kotlin
data class Student(val age: Int)
```

ìœ„ì™€ ê°™ì´ ê¸°ë³¸í˜• íƒ€ì…(Primitive type)ì„ ë˜í¼ í´ë˜ìŠ¤ë¡œ ë˜í•‘í•˜ì—¬ ì‚¬ìš©í•œ ê²½í—˜ì´ ë§ì„ ê²ƒì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì€ ë˜í¼ í´ë˜ìŠ¤ëŠ” ëŸ°íƒ€ì„ ì‹œì— í™ ì˜ì—­ì— ì“¸ ë•Œ ì—†ëŠ” ì˜¤ë²„í—¤ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.

íŠ¹íˆ **ê¸°ë³¸í˜• íƒ€ì…ì€ ëŸ°íƒ€ì„ì— ìµœì í™”**ë˜ì–´ ìˆëŠ”ë°, ì˜ˆì œì™€ ê°™ì´ ê¸°ë³¸í˜• íƒ€ì…ì„ ë˜í¼ í´ë˜ìŠ¤ë¡œ ë˜í•‘í•˜ë©´ **ì„±ëŠ¥ì— ë”ìš± ì•…ì˜í–¥**ì„ ë¼ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì½”í‹€ë¦°ì—ì„œëŠ” value classë¼ëŠ” inline classë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### ì •ì˜

**value class**ëŠ” **inline class**ì…ë‹ˆë‹¤.

inline classëŠ” ê°’ë§Œ ë³´ìœ í•˜ëŠ” **ê°’ ê¸°ë°˜ í´ë˜ìŠ¤ì˜ í•˜ìœ„ í´ë˜ìŠ¤**ë¡œ, **ë‹¨ì¼ ê°’ì„ ë˜í•‘í•  ë•Œ ì‚¬ìš©í•˜ë©´ ì¶”ê°€ ì˜¤ë²„í—¤ë“œ ì—†ì´ í´ë˜ìŠ¤ë¥¼ ìƒì„±**í•˜ë„ë¡ ë•ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```kotlin
inline class Name(val s: String)
```

- `ê°’ ê¸°ë°˜ í´ë˜ìŠ¤(Value-based class)` : **ê°ì²´ì˜ ì‹ë³„ì„±ì´ ì•„ë‹Œ ê°’ì— ì˜í•´ ì •ì˜ë˜ëŠ” í´ë˜ìŠ¤**. ì—¬ê¸°ì„œ ì˜ë¯¸í•˜ëŠ” **ê°ì²´ì˜ ì‹ë³„ì„±**ì€ ë‘ ê°ì²´ë¥¼ êµ¬ë³„í•˜ëŠ” ì†ì„±ìœ¼ë¡œ, ì£¼ë¡œ **ë©”ëª¨ë¦¬ì˜ ìœ„ì¹˜**ê°€ ì´ì— í•´ë‹¹í•¨. ë”°ë¼ì„œ ê°’ ê¸°ë°˜ í´ë˜ìŠ¤ë€, ë©”ëª¨ë¦¬ì˜ ì£¼ì†Œ ê°’ì´ ì•„ë‹Œ ê°’ ê·¸ ìì²´ì— ì˜í•´ì„œ ì •ì˜ë˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì˜ë¯¸í•¨.

Kotlin 1.3 ë²„ì „ë¶€í„° ì•ŒíŒŒ í…ŒìŠ¤íŠ¸ë¡œ ì¶œì‹œëœ inline classëŠ”, Kotlin 1.5 ë²„ì „ë¶€í„° ì •ì‹ ì¶œì‹œë˜ì–´ value classë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë°”ë€Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ì— ì‚¬ìš©ë˜ë˜ inline ì •ì˜ìëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

![Untitled](Value%20Class%200417ec27578149eb9a547d9d920cbb28/Untitled%203.png)

value classëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
@JvmIline
value class Name(val s: String)
```

- `@JvmInline` : value classê°€ inline classì„ì„ ì•Œë ¤ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ, JVM ë°±ì—”ë“œì—ì„œ inline classë¥¼ ì„ ì–¸í•  ë•Œ ì‚¬ìš©ë¨.
    - `JVM Backend` : Kotlin ì½”ë“œë¥¼ JVM ë°”ì´íŠ¸ì½”ë“œë¡œ ì»´íŒŒì¼í•˜ëŠ” ì»´íŒŒì¼ëŸ¬ì˜ ì¼ë¶€. JVM í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¶„ì„í•˜ë©´, JVM ë°±ì—”ë“œì—ì„œ ë¶„ì„í•œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë°”íƒ•ìœ¼ë¡œ JVMì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ íŒŒì¼ë¡œ ë³€í™˜í•¨.

value classë¥¼ í†µí•´ ì´ˆê¸°í™”í•œ ë³€ìˆ˜ëŠ” **ì»´íŒŒì¼ íƒ€ì„ì— ë˜í¼ í´ë˜ìŠ¤ì˜ ê°’ìœ¼ë¡œ ë°”ë€Œì–´ ì €ì¥**ë©ë‹ˆë‹¤.

ì‹¤ì œë¡œ value classë¡œ êµ¬í˜„í•œ ì½”ë“œë¥¼ ìë°” ì½”ë“œë¡œ ë””ì»´íŒŒì¼í–ˆì„ ë•Œ, **í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ê¸°ë³¸í˜• ê°’ íƒ€ì…ìœ¼ë¡œ ì´ˆê¸°í™”**í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
value class Student(val age: Int)

fun main() {
		val student = Studnet(age = 2)
}
```

```java
public final class Student {
	  private final int age;

    public static int constructor_impl(int age) {
       return age;
    }

    ...
}

public final class Main {
		public static final void main() {
				// countì—ëŠ” ê¸°ë³¸í˜• íƒ€ì…ì¸ int 2 ê°’ì´ ì €ì¥ë¨
				final int age = Student.constructor-impl(2);
		}
}
```

## ğŸ§°Â Â í´ë˜ìŠ¤ì˜ ì¼ë¶€ ê¸°ëŠ¥ ì§€ì›

---

### ë©¤ë²„

value calssë„ ì¼ë°˜ í´ë˜ìŠ¤ì™€ ë™ì¼í•˜ê²Œ í´ë˜ìŠ¤ ë‚´ë¶€ì— ë³€ìˆ˜ì™€ í•¨ìˆ˜ ë° ìƒì„±ì ë¸”ëŸ­ì„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
@JvmInline
value class Name(private val s: String) {
    
    init { ... }

    val length get() = s.length

    fun greet() {
        println("Hi, $s")
    }
}
```

í•˜ì§€ë§Œ value classëŠ” ë’·ë°›ì¹¨í•˜ëŠ” í•„ë“œ(Backing Field)ë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— `lateinit`ì„ ì„ ì–¸í•  ìˆ˜ ì—†ìœ¼ë©°, `by lazy`ì™€ ê°™ì€ Delegated Propertiesë„ ì„ ì–¸ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### ìƒì†

value calssëŠ” ì¸í„°í˜ì´ìŠ¤ ìƒì† ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ value classëŠ” í•­ìƒ `final`ë¡œ ì§€ì •ë˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ì—¬ í™•ì¥í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•œ ì½”ë“œë„ ë‹¤ë¥¸ ë‚´ë¶€ í•¨ìˆ˜ì™€ ë™ì¼í•˜ê²Œ `static` ë©”ì„œë“œë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```kotlin
interface Foo {
    fun greet()
}

@JvmInline
value class Student(val age: Int) : Foo {

    override fun greet() {
        println("Hello, I'm $age.")
    }
}
```

```java
public final class Student implemnets Foo {
	  private final int age;
		
    public void greet() {
      greet-impl(this.age);
    }

		// static ë©”ì„œë“œë¡œ êµ¬í˜„ë¨
		public static void greet_impl(int $this) {
      String var1 = "Hello, I'm " + $this + '.';
      System.out.println(var1);
    }
 
    ...
}
```

## ğŸ“¦Â  value classì˜ boxing

---

ì‚¬ì‹¤ìƒ ê¸°ë³¸í˜• íƒ€ì…ì´ì§€ë§Œ ì™¸ë¶€ëŠ” í´ë˜ìŠ¤ì˜ ëª¨ì–‘ì„¸ì¸ ë§Œí¼, ì–´ë–¨ ë•ŒëŠ” í´ë˜ìŠ¤ì˜ í˜•íƒœë¡œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, **ì œë„¤ë¦­ íƒ€ì…**ìœ¼ë¡œ value classê°€ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ëŠ” ê²½ìš°ì—ëŠ” ê¸°ë³¸í˜• íƒ€ì…ì´ ì•„ë‹Œ **boxingëœ ë˜í¼ íƒ€ì…ìœ¼ë¡œ ìë™ ë°˜í™˜**ë©ë‹ˆë‹¤.

```kotlin
interface I

@JvmInline
value class Foo(val i: Int) : I

fun asInline(f: Foo) {}
fun <T> asGeneric(x: T) {}
fun asInterface(i: I) {}
fun asNullable(i: Foo?) {}

fun <T> id(x: T): T = x

fun main() {
    val f = Foo(42)

    asInline(f) // unboxed
    asGeneric(f) // boxed
    asInterface(f) // boxed
    asNullable(f) // boxed 
    
    // fëŠ” ì²˜ìŒ boxingë˜ì–´ ì œë„¤ë¦­ ê°’ìœ¼ë¡œ ì „ë‹¬ë˜ê³ , cì— ë°˜í™˜ë  ë•Œ unboxingë˜ì–´ 42ë¥¼ ë°˜í™˜í•¨
    val c = id(f) // val c = 42
}
```

```java
public static final void main() {
    int f = Foo.constructor-impl(42);
    asInline-9qDqOCk(f); // unboxed
    asGeneric(Foo.box-impl(f)); // boxed
    asInterface(Foo.box-impl(f)); // boxed
    asNullable-6aipi8o(Foo.box-impl(f)); // boxed
    int c = ((Foo)id(Foo.box-impl(f))).unbox-impl(); // boxed -> unboxed
 }
```

value classëŠ” ì°¸ì¡° í‰ë“± ì—°ì‚°ì(`===`)ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ë³¸ ê°’ê³¼ ë˜í¼ë¡œ ëª¨ë‘ í‘œí˜„ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°ì²´ì˜ ì£¼ì†Œ ê°’ì„ ë¹„êµí•˜ëŠ” ì°¸ì¡° í‰ë“± ë¹„êµëŠ” ë¬´ì˜ë¯¸í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### ë§¹ê¸€ë§ (Mangling)

ë§¹ê¸€ë§ì€ ì˜¤ë²„ë¡œë”©ê³¼ ê°™ì´ ë™ì¼í•œ ì´ë¦„ì˜ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ì˜€ì„ ë•Œ, ì»´íŒŒì¼ëŸ¬ê°€ í•¨ìˆ˜ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ í•¨ìˆ˜ì— íŠ¹ì • í•´ì‹œì½”ë“œë¥¼ ë¶™ì´ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤.

value classëŠ” ì»´íŒŒì¼ íƒ€ì„ì— ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ì»´íŒŒì¼ë˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ê°™ì€ íƒ€ì…ì˜ íŒŒë¼ë¯¸í„°ë¡œ ì¶©ëŒì„ ì•¼ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```kotlin
@JvmInline
value class UInt(val value: Int)

fun compute(x: Int) { ... }

// compute(x: Int)ë¡œ ì»´íŒŒì¼ë˜ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜!
fun compute(x: UInt) { ... }
```

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ì½”í‹€ë¦° 1.4.3ë¶€í„°ëŠ” value classì˜ ë§¹ê¸€ë§ì„ ì§€ì›í•©ë‹ˆë‹¤. ìœ„ ì½”ë“œë¥¼ ë””ì»´íŒŒì¼í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ í•¨ìˆ˜ëª… ë’¤ì— ì„ì˜ì˜ í•´ì‹œì½”ë“œê°€ ë¶™ì—¬ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public static final void compute(int x) { ... }

// í•¨ìˆ˜ëª… ë’¤ì— í•´ì‹œì½”ë“œê°€ ë¶™ìŒ!
public static final void **compute_hUb9Lp8(int x) { ... }
```

### ìë°” ì½”ë“œì—ì„œ ì´ë¦„ ë³€ê²½í•˜ê¸°

Kotlin 1.4.3 ì´ì „ ë²„ì „ì—ì„œ ì˜¤ë²„ë¡œë”© ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´, `@JvmName` ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ í•¨ìˆ˜ëª…ì„ ë³€ê²½í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. `@JvmName`ìœ¼ë¡œ ì´ë¦„ì„ ì§€ì •í•œ í•¨ìˆ˜ëŠ” ìë°” ì½”ë“œë¡œ ë””ì»´íŒŒì¼ ë  ë•Œ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ë°”ë€Œì–´ ì»´íŒŒì¼ë©ë‹ˆë‹¤.

```kotlin
fun compute(x: Int) { ... }

@JvmName("computeUInt")
fun compute(x: UInt) { ... }
```

```java
public static final void compute(int x) { ... }

@JvmName(name = "computeUInt")
public static final void **computeUInt**(int x) { ... }
```

## ğŸ’¬Â  ë‹¤ë¥¸ íƒ€ì… í´ë˜ìŠ¤ì™€ì˜ ì°¨ì´ì  ì•Œì•„ë³´ê¸°

---

### data class vs value class

ì–¼í•ë³´ë©´ ë°ì´í„°ë¥¼ ë˜í•‘í•˜ê³  ìƒì„±í•œë‹¤ëŠ” ì ì—ì„œ ìœ ì‚¬í•œ data classì™€ value class! í•˜ì§€ë§Œ ì´ ë‘˜ì€ ì•„ë˜ì™€ ê°™ì€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.

1. **íŒŒë¼ë¯¸í„° ì§€ì›**

   ë¨¼ì €, **value class**ëŠ” ê°’ ê¸°ë°˜ì˜ í´ë˜ìŠ¤ì´ë¯€ë¡œ, **ë‹¨ì¼ íŒŒë¼ë¯¸í„°ë§Œ ì„ ì–¸ ê°€ëŠ¥**í•©ë‹ˆë‹¤. ë˜í•œ, value classëŠ” ì»´íŒŒì¼ íƒ€ì„ì— ê¸°ë³¸í˜• íƒ€ì…ìœ¼ë¡œ ë°”ë€Œì–´ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— **Immutableí•œ ê°’ë§Œ í—ˆìš©**í•©ë‹ˆë‹¤. (`var` X, `val` O)

   mutableí•œ ê°’ ì„ ì–¸ì„ í—ˆìš©í•˜ê²Œ ëœë‹¤ë©´, í•´ë‹¹ ê°’ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í™ ë©”ëª¨ë¦¬ë¡œë¶€í„° ì£¼ì†Œ ê°’ì„ í• ë‹¹ ë°›ì•„ì•¼ í•˜ë¯€ë¡œ, value classì˜ ì˜ì˜ë¥¼ ìƒê²Œ ë©ë‹ˆë‹¤.

   ë°˜ëŒ€ë¡œ, **data class**ëŠ” **ì—¬ëŸ¬ ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆê³ , mutableí•œ ê°’ë„ í—ˆìš©**í•©ë‹ˆë‹¤.

2. **ê¸°ë³¸ í•¨ìˆ˜ ì§€ì› ì—¬ë¶€**

   **value classëŠ” data classì—ì„œ ì§€ì›í•˜ëŠ” ì—¬ëŸ¬ ê¸°ë³¸ í•¨ìˆ˜ë“¤ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.** `toString()`, `equals()`, `hashCode()`ì™€ ê°™ì€ ë©”ì„œë“œëŠ” ê³µí†µì ìœ¼ë¡œ ì§€ì›í•˜ì§€ë§Œ, ê°’ì˜ ë³µì œë¥¼ ë„ì™€ì£¼ëŠ” `copy()`ë‚˜ ê°’ì˜ ì ‘ê·¼ì„ ë•ëŠ” `componentN()`ê³¼ ê°™ì€ í•¨ìˆ˜ëŠ” ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

   ì• ì´ˆì— value classëŠ” ë‹¨ì¼ ê°’ë§Œ ì§€ì›í•˜ë‹ˆ í•„ìš”ì—†ì£ !

3. **ì¸ë¼ì´ë‹**

   ì•ì˜ ë‚´ìš©ì—ì„œ ì–¸ê¸‰í–ˆë‹¤ì‹œí”¼, value classëŠ” ì¸ë¼ì´ë‹ ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë°ì´í„° í´ë˜ìŠ¤ëŠ” ë‹¨ìˆœ í´ë˜ìŠ¤ë¡œì¨ì˜ ê¸°ëŠ¥ë§Œì„ ì œê³µí•©ë‹ˆë‹¤.


ì‚¬ìš© ëª©ì ì— ë”°ë¼ value classì™€ data classë¥¼ êµ¬ë¶„í•´ì„œ ì‚¬ìš©í•˜ë©´ ë  ë“¯í•©ë‹ˆë‹¤.

ë‹¨ìˆœ ë˜í¼ í´ë˜ìŠ¤ê°€ í•„ìš”í•œ ê²½ìš°ë¼ë©´ value classë¥¼ ì‚¬ìš©í•˜ê³ , íŒŒë¼ë¯¸í„° ê°’ì´ ì—¬ëŸ¬ ê°œì´ê±°ë‚˜ data classê°€ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³ ì í•œë‹¤ë©´ data classë¥¼ ì‚¬ìš©í•˜ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## ğŸ§¹Â  ì •ë¦¬

---

> ê¸°ë³¸í˜• íƒ€ì…ì„ ë˜í¼ í´ë˜ìŠ¤ë¡œ ë˜í•‘í•˜ë©´ ì“¸ ë•Œ ì—†ëŠ” ì˜¤ë²„í—¤ë“œë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì—,
ê°’ì˜ ì¸ë¼ì´ë‹ì„ ë•ëŠ” value classë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ ì¤„ì´ì!
>

---

- [Inline classes | Kotlin Documentation](https://kotlinlang.org/docs/inline-classes.html)
- [Object lifetime - Wikipedia](https://en.wikipedia.org/wiki/Object_lifetime)
- [C++ ìƒì—ì„œ ë°œìƒí•˜ëŠ” name manglingì— ê´€í•œ ë‚´ìš©](https://spikez.tistory.com/m/19)
- [Value-based Classes (Java SE 17 & JDK 17) - Oracle](https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/lang/doc-files/ValueBased.html)